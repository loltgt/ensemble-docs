!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var s={exports:{}};e(s.exports),t.ensemble=s.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(t){"use strict";
/*!
   * loltgt ensemble.Compo
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=t.Lightbox=void 0;const e="undefined"==typeof Symbol?0:Symbol,s=/html|head|body|meta|link|style|script/i,i=/(<(html|head|body|meta|link|style|script)*>)/i,n=/attributes|classList|innerHTML|outerHTML|nodeName|nodeType/;class o{constructor(t,e,i,r){if(!new.target)throw"ensemble error: Bad invocation, must be called with new.";const a=this._ns="_"+t,h=i?e.toString():"div";if(s.test(h))throw new Error(`ensemble.Compo error: The tag name provided ('${h}') is not a valid name.`);const c=this[a]=document.createElement(h);if(this.__Compo=!0,this[a].__compo=this,r&&"object"==typeof r)for(const e in r){const s=e.toString();if(n.test(s))throw new Error(`ensemble.Compo error: The property name provided ('${s}')' is not a valid name.`);if(0===s.indexOf("on")&&r[s])c[s]=r[s].bind(this);else if("object"!=typeof r[s])c[s]=r[s];else if("children"===s&&"object"==typeof r[s]&&r[s].length)for(const e of r.children){const s=e.tag,i=e.name,n=e.props;this.append(new o(t,s,i,n))}}if(0!=i&&1!=i){const s=c.className;c.className=t+"-"+e,i&&(c.className+=" "+t+"-"+i),s&&(c.className+=" "+s)}}install(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.appendChild(this[this._ns])}uninstall(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.removeChild(this[this._ns])}up(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.replaceWith(this[this._ns])}append(t){const e=this._ns;return!!this[e].appendChild(t[e])}prepend(t){const e=this._ns;return!!this[e].prependChild(t[e])}remove(t){const e=this._ns;return!!this[e].removeChild(t[e])}replace(t){}clone(t=!1){}inject(t){if(t instanceof Element==0||s.test(t.tagName)||i.test(t.innerHTML))throw new Error("ensemble.Compo error: The remote object could not be resolved into a valid node.");return this.empty(),!!this[this._ns].appendChild(t)}empty(){for(;this.first;)this.remove(this.first)}hasAttr(t){return this[this._ns].hasAttribute(t)}getAttr(t){return this[this._ns].getAttribute(t)}setAttr(t,e){this[this._ns].setAttribute(t,e)}delAttr(t){this[this._ns].removeAttribute(t)}getStyle(t){return window.getComputedStyle(this[this._ns])[t]}show(){this[this._ns].hidden=!1}hide(){this[this._ns].hidden=!0}enable(){this[this._ns].disabled=!1}disable(){this[this._ns].disabled=!0}get node(){return console.warn("ensemble.Compo","Direct access to the Element node is strongly discouraged."),this[this._ns]}get parent(){const t=this._ns;return this[t].parentElement&&"__compo"in this[t].parentElement?this[t].parentElement.__compo:null}get children(){return Array.prototype.map.call(this[this._ns].children,(t=>t.__compo))}get first(){const t=this._ns;return this[t].firstElementChild?this[t].firstElementChild.__compo:null}get last(){const t=this._ns;return this[t].lastElementChild?this[t].lastElementChild.__compo:null}get previous(){const t=this._ns;return this[t].previousElementSibling?this[t].previousElementSibling.__compo:null}get next(){const t=this._ns;return this[t].nextElementSibling?this[t].nextElementSibling.__compo:null}get classList(){return this[this._ns].classList}static isCompo(t){return e?e.for(t)===e.for(o.prototype):t&&"object"==typeof t&&"__Compo"in t}get[e.toStringTag](){return"ensemble.Compo"}}
/*!
   * loltgt ensemble.Data
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */const r="undefined"==typeof Symbol?0:Symbol;class a{constructor(t,e){if(!new.target)throw"ensemble error: Bad invocation, must be called with new.";e&&"object"==typeof e&&Object.assign(this,{},e);const s=this._ns="_"+t;this.__Data=!0,this[s]={ns:t}}compo(t,e,s,i=!1,n=!1,r=!1){const a=this[this._ns].ns;let h;return h=i?{ns:a,tag:t,name:e,props:s,fresh:n,stale:r}:new o(a,t,e,s),n&&"function"==typeof n&&(h.fresh=s.onfresh=n),r&&"function"==typeof r&&(h.stale=s.onstale=r),h}async render(t){const e=this._ns;this[e][t]&&this[e][t].rendered||(this[e][t]={rendered:!0,fresh:this[t].fresh,stale:this[t].stale,params:this[t]},this[t]=new o(this[t].ns,this[t].tag,this[t].name,this[t].props)),this[e][t].fresh()}async stale(t){const e=this._ns;this[e][t]&&this[e][t].rendered&&this[e][t].stale()}async reflow(t,e){const s=this._ns;e?this[s][t]=this.compo(this[s][t].params.ns,this[s][t].params.name,this[s][t].params.props):this[s][t]&&this[s][t].rendered&&this[s][t].fresh()}static isData(t){return r?r.for(t)===r.for(a.prototype):t&&"object"==typeof t&&"__Data"in t}get[r.toStringTag](){return"ensemble.Data"}}
/*!
   * loltgt ensemble.Event
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */const h="undefined"==typeof Symbol?0:Symbol;class c{constructor(t,e,s){if(!new.target)throw"ensemble error: Bad invocation, must be called with new.";const i=this._ns="_"+t;s=(o.isCompo(s)?s.node:s)||document,this.__Event=!0,this[i]={name:e,node:s}}add(t,e=!1){this[this._ns].node.addEventListener(this[this._ns].name,t,e)}remove(t){this[this._ns].node.removeEventListener(this[this._ns].name,t)}static isEvent(t){return h?h.for(t)===h.for(c.prototype):t&&"object"==typeof t&&"__Event"in t}get[h.toStringTag](){return"ensemble.Event"}}
/*!
   * loltgt ensemble.base
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */
/*!
   * loltgt ensemble.Modal
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */
class l extends class{constructor(){if(!new.target)throw"ensemble error: Bad invocation, must be called with new."}defaults(t,e){const s={};for(const i in t)null!=t[i]&&"object"==typeof t[i]?s[i]=Object.assign(t[i],e[i]):s[i]=void 0!==e[i]?e[i]:t[i];return s}compo(t,e,s){return t?new o(this.options.ns,t,e,s):o}data(t){return t?new a(this.options.ns,t):a}event(t,e){return"string"==typeof t?new c(this.options.ns,t,e):t?(t.preventDefault(),void t.target.blur()):c}selector(t,e,s=!1){return e=e||document,s?e.querySelectorAll(t):e.querySelector(t)}appendNode(t,e){return!!t.appendChild(e)}prependNode(t,e){return!!t.prependChild(e)}removeNode(t,e){return!!t.removeChild(e)}cloneNode(t,e=!1){return t.cloneNode(e)}hasAttr(t,e){return t.hasAttribute(e)}getAttr(t,e){return t.getAttribute(e)}setAttr(t,e,s){t.setAttribute(e,s)}delAttr(t,e){t.removeAttribute(e)}binds(t){const e=this;return function(s){t.call(e,s,this)}}delay(t,e,s){const i=e?this.timing(e):0;setTimeout(t,i||s)}timing(t,e="transitionDuration"){let s=o.isCompo(t)?t.getStyle(e):window.getComputedStyle(t)[e];return s&&(s=s.indexOf("s")?1e3*parseFloat(s):parseInt(s)),s||0}}{_defaults(){return{ns:"modal",root:"body",fx:!0,windowed:!1,cloning:!0,backClose:!0,keyboard:!0,close:{onclick:this.close,innerText:"Ã—",ariaLabel:"Close"},onOpen:function(){},onClose:function(){},onShow:function(){},onHide:function(){},onContent:function(){}}}_bindings(){this.open=this.binds(this.open),this.close=this.binds(this.close),this.backx=this.binds(this.backx),this.keyboard=this.binds(this.keyboard)}constructor(t,e={}){super(),this._bindings(),this.options=this.defaults(this._defaults(),e),Object.freeze(this.options),this.element=t}generator(){const t=this.options,e=this.box=this.data({onclick:!1}),s=this.box.wrap=this.compo("dialog",!0,{className:t.ns,hidden:!0,ariaModal:!0,role:"dialog",onclick:function(){e.onclick&&"function"==typeof e.onclick&&e.onclick.apply(this,arguments)}}),i=this.cnt=this.compo("content"),n=this.compo("button","close",t.close);s.append(i),t.windowed?(s.classList.add(t.ns+"-windowed"),i.append(n)):s.append(n),t.backClose&&(this.box.onclick=this.backx),t.fx&&s.classList.add(t.ns+"-fx"),this.root=this.selector(t.root),this.built=!0}populate(t){console.log("ensemble.Modal","populate()",t);const e=this.content(this.element);this.cnt.append(e)}resume(t){console.log("ensemble.Modal","resume()",t)}content(t,e){const s=this.options,i=this.compo("object");let n=(e=void 0!==e?e:s.cloning)?this.cloneNode(t,!0):t;return s.onContent.call(this,this,i,n),n&&i.inject(n),i}destroy(){const t=this.root,e=this.box.wrap;this.removeNode(t,e),this.built=!1}open(t,e){if(this.event(t),this.opened)return;const s=this.options;this.built?this.resume(e):(this.generator(),this.populate(e)),this.opened=!0,s.onOpen.call(this,this,e,t),this.show(e),s.keyboard&&this.event("keydown").add(this.keyboard),console.log("ensemble.Modal","open()",this)}close(t,e){if(this.event(t),!this.opened)return;const s=this.options;this.opened=!1,s.onClose.call(this,this,e,t),this.hide(e),s.keyboard&&this.event("keydown").remove(this.keyboard),console.log("ensemble.Modal","close()",this)}show(t){const e=this.options,s=this.root;this.box;const i=this.box.wrap;i.install(s),this.delay((function(){i.show(),e.onShow.call(self,self,t)}))}hide(t){const e=this.options,s=this.root;this.box;const i=this.box.wrap;i.hide(),this.delay((function(){i.uninstall(s),e.onHide.call(self,self,t)}),i,300)}backx(t){this.event(t);const e=t.target,s=e.parentElement,i=this.options.ns;var n;if(((n=new RegExp(i+"-content")).test(e.className)||n.test(s.className))&&(console.log("ensemble.Modal","backx()","outside cropbox area",":then: close",s,e),this.close(t)),!(n=new RegExp(i+"-object")).test(e.className))return void console.log("ensemble.Modal","backx()","outside cropbox area",":then: skip",s,e);const o=e.firstElementChild,r=o.offsetWidth,a=o.offsetHeight,h=e.offsetTop,c=e.offsetLeft,l=e.offsetWidth,p=e.offsetHeight,d=event.x,f=event.y,u=(p-a)/2,m=(l-r)/2,g=u+a,b=m+r;console.log("ensemble.Modal","backx()","coords",{x:d,y:f},{target_t:h,target_l:c,target_w:l,target_h:p},{crop_t:u,crop_r:b,crop_b:g,crop_l:m}),(f>h||d>c||d<l||f<p)&&(f<u||d>b||f>g||d<m)&&(console.log("ensemble.Modal","backx()","outside cropbox area",":then: close",s,e),this.close(t))}keyboard(t){this.event(t);27===(t.keyCode||0)&&this.close(t)}}
/*!
   * loltgt ensemble.Lightbox
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */t.Modal=l;t.Lightbox=class extends l{_defaults(){return Object.assign(super._defaults(),{selector:"",contents:null,navigation:!0,captioned:!0,infinite:!0,autoDiscover:!0,autoHide:"navigation",overlayed:!1,checkOrigin:!0,prev:{onclick:this.prev,innerText:"<",ariaLabel:"Previous"},next:{onclick:this.next,innerText:">",ariaLabel:"Next"},onStep:function(){},onSlide:function(){},onCaption:function(){}})}_bindings(){super._bindings(),this.add=this.binds(this.add),this.remove=this.binds(this.remove),this.prev=this.binds(this.prev),this.next=this.binds(this.next)}generator(){super.generator();const t=this.box.wrap,e=this.cnt,s=this.options,i=this.gallery=this.compo("gallery");if(e.append(i),t.classList.add(s.ns+"-lightbox"),s.navigation){var n=this.nav=this.data(!0);const t=n.wrap=this.compo("nav"),e=n.prev=this.compo("button","prev",s.prev),i=n.next=this.compo("button","next",s.next);t.append(e),t.append(i)}if(s.captioned){var o=this.captions=this.data(!0);o.wrap=this.compo("captions")}if(s.overlayed){const e=s.overlayed.toString().match(/captions|navigation/);t.classList.add(s.ns+"-overlayed"),e&&t.classList.add(s.ns+"-overlayed-"+overlayed[0])}if(s.autoHide){const e=s.autoHide.toString().match(/captions|navigation/);t.classList.add(s.ns+"-autohide"),e&&t.classList.add(s.ns+"-autohide-"+e[0])}s.windowed?(s.navigation&&e.append(n.wrap),s.captioned&&e.append(o.wrap)):(s.navigation&&t.append(n.wrap),s.captioned&&t.append(o.wrap))}populate(t){console.log("ensemble.Lightbox","populate",t);const e=this.options;let s;e.contents&&"object"==typeof e.contents?s=e.contents:e.selector&&(s=this.selector(e.selector,this.element,!0)),s=this.contents=this.prepare(s);for(const e of s){const i=this.content(e);t&&t===i.ref&&(this.index=s.indexOf(i),this.current=i),this.add(i)}this.current=this.current||s[0],this.index=this.index||0,this.slide(0),e.navigation&&this.navigation(),e.captioned&&this.caption()}resume(t){console.log("ensemble.Lightbox","resume",t);const e=this.options,s=this.contents;for(const e of s)e.wrap.hide(),t&&t===e.ref&&(this.index=s.indexOf(e),this.current=e);this.current=this.current||s[0],this.index=this.index||0,this.slide(0),e.navigation&&this.navigation(),e.captioned&&this.caption()}content(t,e){const s=this.options,i=this.compo("object");var n;i.hide();const o=(n="string"==typeof t?this.data({src:t}):t).src;let r=n.type,a=n.type;a&&(a=a.match(/(^image|video|audio)|(pdf$)/),a=a?a[0]:"");const h=/^https?:\/\//.test(o);let c,l=!1;if(s.autoDiscover&&o&&!a&&(/\.jpg|\.jpeg|\.png|\.apng|\.gif|\.webp|\.avif|\.bmp|\.svg$/i.test(o)?a="image":/\.pdf$/.test(o)?a="pdf":/\.mp4|\.webm|\.ogv|\.m4v|\.hevc|\.ivf|\.obu|\.ismv|\.mkv$/i.test(o)?a="video":/\.mp3|\.opus|\.ogg|\.m4a|\.aac|\.flac|\.wav|\.weba|\.mka$/i.test(o)?a="audio":/^data:image\/jpeg|png|apng|gif|webp|avif|bmp|svg\+xml/.test(o)&&(l=!0,a="image")),"pdf"==a&&(a="iframe",c="pdf"),s.checkOrigin&&o&&h&&!l){("null"!=window.origin?window.origin:window.location.origin)!=new URL(o).origin&&(a="")}if(o&&!a)if("#"==o[0]){const t=this.selector(o);t&&(n.node=t,a=/iframe|img|picture|video|audio/i.test(t.nodeName)?/img|picture/i.test(t.nodeName)?"image":t.nodeName.toLowerCase():"element")}else a="iframe";"element"===a&&(e=void 0!==e?e:s.cloning,n.node=e?this.cloneNode(n.node,!0):n.node),c||r==a||(c=r),n.ref=n.ref||null,n.type=a,n.src=o,s.onContent.call(this,this,n),a&&i.classList.add(s.ns+"-"+a),c&&i.classList.add(s.ns+"-"+c);const p=this.inner(n);return n.fresh=function(){n.node&&n.inner.inject(n.node),n.wrap.show()},n.stale=function(){n.node&&n.inner.empty(),n.wrap.hide()},n.wrap=i,n.inner=n.compo(p.tag,p.name,p.props,!0,n.fresh,n.stale),n}inner(t){let e=t.type,s=!0,i={};for(const e in t)/ref|src|type|sources|subtitles|children/.test(e)||"_"==e[0]||(i[e]=t[e]);switch(t.src&&(i.src=t.src),t.type){case"image":if(e="img",t.sources||t.children)if(e="picture",i.children=[],t.sources&&"object"==typeof t.source)for(const e of t.sources)i.children.push({tag:"source",name:!0,props:e});else if(t.children&&t.children.length)for(const e of t.children){const t=e.tagName.toLowerCase();"source"==t&&"img"==t&&i.children.push({tag:t,name:!0,props:e.attributes})}break;case"video":case"audio":if(i.controls=!t.controls||t.controls,i.children=[],t.sources&&"object"==typeof t.sources){for(const e of t.sources)i.children.push({tag:"source",name:!0,props:e});if(t.subtitles&&"object"==typeof t.subtitles)for(const e of t.subtitles)i.children.push({tag:"track",name:!0,props:e})}else if(t.children&&t.children.length)for(const e of t.children){const t=e.tagName.toLowerCase();"source"==t&&"track"==t&&i.children.push({tag:t,name:!0,props:e.attributes})}break;case"iframe":if(i.frameBorder=0,!i.src)return null;break;default:e="div",s="custom-element"}return{tag:e,name:s,props:i}}prepare(t){const e=[];if(t&&"object"==typeof t&&t.length)for(const s of t)if("object"==typeof s&&"nodeName"in s){const t=this.data(!0),i=s.dataset;if(Object.assign(t,i),t.ref=s,i.sources)try{t.sources=JSON.parse(i.sources)}catch{}if(s.href)t.src=s.href;else if(i.href)t.src=i.href;else if(/iframe|img|picture|video|audio/i.test(s.nodeName)){const e=s.nodeName.toLowerCase();/img|picture/.test(e)?t.type="image":t.type=e,"iframe"!=e&&s.children&&s.children.length&&(t.children=s.children)}else t.type="element",t.node=s;i.caption&&(t.caption=i.caption),e.push(t)}else"string"==typeof s?e.push(s):"type"in s&&/(^element|iframe|image|video|audio|pdf)/.test(s.type)?e.push(this.data(s)):e.push(this.data(!0));return e}add(t){this.gallery.append(t.wrap),this.options.navigation&&this.navigation()}remove(t){this.gallery.remove(t.wrap),this.options.navigation&&this.navigation()}prev(t){this.event(t),this.slide(-1)}next(t){this.event(t),this.slide(1)}slide(t){const e=this.options;if(!e.infinite&&0!=this.way&&this.way===t)return;const s=this.contents;let i=this.index,n=this.current,o=n;if(e.onStep.call(this,this,n,t),0!=t){const e=s.length-1,r=-1===t?s[i-1]:s[i+1],a=-1===t?s[e]:s[0];o=r||a,i=r?-1===t?i-1:i+1:-1===t?e:0,n.stale("inner")}if(!e.infinite){let t=0;o.wrap.previous?o.wrap.next||(t=1):t=-1,this.way=parseInt(t),e.navigation&&this.navigation(t)}o.render("inner"),o.wrap.append(o.inner),e.onSlide.call(this,this,n,t,n.wrap!=o.wrap?o.wrap:null),this.delay((function(){0!=t&&n.wrap.remove(n.inner)}),n.wrap),this.index=i,this.current=s[i],e.captioned&&this.caption()}navigation(t){const e=this.nav;if(this.contents.length>1){if(e.wrap.show(),!this.options.infinite&&void 0!==t)switch(t){case-1:e.prev.disable(),e.next.enable();break;case 1:e.prev.enable(),e.next.disable();break;default:e.prev.enable(),e.next.enable()}}else e.wrap.hide()}caption(t){const e=this.options,s=this.captions,i=this.current;if(s.wrap.empty(),!e.onCaption(this,this,i,t)){if(!t)if(i.caption)t=i.caption;else if(e.selector){const e=i.ref;if(this.hasAttr(e,"title"))t=this.getAttr(e,"title");else if("image"===i.type){t=this.selector("img",e).alt}}if(t){t=t.split(/\n\n|\r\n\r\n/);for(const e of t){const t=this.compo("p",!0,{innerText:e});s.wrap.append(t)}}}}keyboard(t){super.keyboard(t);switch(t.keyCode||0){case 37:this.prev(t);break;case 39:this.next(t)}}}}));